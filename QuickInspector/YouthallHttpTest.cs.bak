using System.Net.Http;
using HtmlAgilityPack;
using ListingMonitor.Infrastructure.Scraping.Adapters;

namespace ListingMonitor.Test;

public class YouthallHttpTest
{
    public static async Task Main(string[] args)
    {
        Console.WriteLine("ğŸŒ Youthall Pagination Test (TÃ¼m Sayfalar)");
        Console.WriteLine("=============================================");
        
        var adapter = new YouthallAdapter();
        
        try
        {
            Console.WriteLine("ğŸš€ Youthall pagination scraping baÅŸlatÄ±lÄ±yor...");
            Console.WriteLine("â±ï¸ Bu iÅŸlem biraz sÃ¼rebilir (18 sayfa ~ 18 saniye)...");
            
            var listings = await adapter.ScrapeAsync();
            
            Console.WriteLine($"\nğŸ“Š SonuÃ§lar:");
            Console.WriteLine($"   âœ… Toplam {listings.Count} ilan bulundu");
            
            if (listings.Any())
            {
                Console.WriteLine("\nğŸ† Ä°lk 5 ilan:");
                foreach (var listing in listings.Take(5))
                {
                    Console.WriteLine($"   â€¢ {listing.Title}");
                    Console.WriteLine($"     ğŸ¢ {listing.Company}");
                    Console.WriteLine($"     ğŸ”— {listing.Url}");
                    if (!string.IsNullOrWhiteSpace(listing.Description))
                    {
                        Console.WriteLine($"     ğŸ“ {listing.Description}");
                    }
                    Console.WriteLine();
                }
                
                Console.WriteLine("ğŸ¯ Pagination BAÅARILI! TÃ¼m sayfalar tarandÄ±.");
                Console.WriteLine("ğŸ“ˆ ArtÄ±k bu adapter mevcut sisteminize entegre edilebilir!");
            }
            else
            {
                Console.WriteLine("âŒ HiÃ§ ilan bulunamadÄ±.");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"\nâŒ Test hatasÄ±: {ex.Message}");
            Console.WriteLine($"   Stack: {ex.StackTrace}");
        }
        finally
        {
            adapter.Dispose();
        }
        
        Console.WriteLine("\nğŸ‰ Test tamamlandÄ±! Ã‡Ä±kmak iÃ§in Enter...");
        Console.ReadLine();
    }
}
