using ListingMonitor.Infrastructure.Scraping;
using ListingMonitor.Infrastructure.Scraping.Adapters;

namespace ListingMonitor.Test;

public class YouthallIntegrationTest
{
    public static async Task Main(string[] args)
    {
        Console.WriteLine("ğŸš€ Youthall Integration Test");
        Console.WriteLine("=============================");
        
        try
        {
            // DoÄŸrudan modern adapter test
            Console.WriteLine("ğŸ”„ ModernScrapingService testi baÅŸlatÄ±lÄ±yor...");
            
            var scrapingService = new ModernScrapingService();
            
            // Youthall sitesi mock
            var youthallSite = new ListingMonitor.Domain.Entities.Site
            {
                Id = 4,
                Name = "Youthall",
                BaseUrl = "https://www.youthall.com/tr/jobs/",
                SiteType = ListingMonitor.Domain.Enums.SiteType.Manual
            };
            
            Console.WriteLine($"âœ… Youthall sitesi: {youthallSite.Name}");
            Console.WriteLine($"   URL: {youthallSite.BaseUrl}");
            
            // Scraping test
            var listings = await scrapingService.FetchListingsAsync(youthallSite, null);
            
            Console.WriteLine($"\nğŸ“Š SonuÃ§: {listings.Count} ilan bulundu");
            
            if (listings.Any())
            {
                Console.WriteLine("\nğŸ† Ä°lk 3 ilan:");
                foreach (var listing in listings.Take(3))
                {
                    Console.WriteLine($"   â€¢ {listing.Title}");
                    Console.WriteLine($"     ğŸ¢ {listing.Company}");
                    Console.WriteLine($"     ğŸ”— {listing.Url}");
                    Console.WriteLine($"     ğŸ†” {listing.ExternalId}");
                    Console.WriteLine($"     ğŸ“ {listing.Description}");
                    Console.WriteLine();
                }
            }
            
            Console.WriteLine("\nğŸ‰ Youthall entegrasyon testi BAÅARILI!");
            Console.WriteLine("ğŸš€ ModernScrapingService Ã§alÄ±ÅŸÄ±yor - ScraperSchedulerService'e hazÄ±r!");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"\nâŒ Test hatasÄ±: {ex.Message}");
            Console.WriteLine($"   Stack: {ex.StackTrace}");
        }
        finally
        {
            // Cleanup
            GC.Collect();
        }
        
        Console.WriteLine("\nğŸ Test tamamlandÄ±! Ã‡Ä±kmak iÃ§in Enter...");
        Console.ReadLine();
    }
}
