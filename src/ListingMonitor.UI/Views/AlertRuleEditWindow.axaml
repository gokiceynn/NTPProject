<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ListingMonitor.UI.ViewModels"
        mc:Ignorable="d" d:DesignWidth="650" d:DesignHeight="750"
        x:Class="ListingMonitor.UI.Views.AlertRuleEditWindow"
        x:DataType="vm:AlertRuleEditViewModel"
        Title="{Binding WindowTitle}"
        Width="650" Height="750"
        WindowStartupLocation="CenterOwner"
        Background="{Binding ThemeBg}">

  <Design.DataContext>
    <vm:AlertRuleEditViewModel/>
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*,Auto,Auto">
    <!-- Header -->
    <Border Grid.Row="0" Background="{Binding ThemeCardBg}" Padding="24,20">
      <StackPanel Spacing="4">
        <TextBlock Text="{Binding WindowTitle}" FontSize="20" FontWeight="Bold" Foreground="{Binding ThemeText}"/>
        <TextBlock Text="Ä°lan filtrelerinizi ve bildirim ayarlarÄ±nÄ±zÄ± yapÄ±landÄ±rÄ±n" FontSize="12" Foreground="{Binding ThemeTextSecondary}"/>
      </StackPanel>
    </Border>

    <!-- Content -->
    <ScrollViewer Grid.Row="1" Padding="24">
      <StackPanel Spacing="20">
        
        <!-- Basic Info -->
        <Border Background="{Binding ThemeCardBg}" CornerRadius="12" Padding="20">
          <StackPanel Spacing="16">
            <StackPanel Orientation="Horizontal" Spacing="10">
              <Border Background="#3B82F620" CornerRadius="8" Width="36" Height="36">
                <TextBlock Text="ðŸ“‹" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
              </Border>
              <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Temel Bilgiler" FontSize="15" FontWeight="Bold" Foreground="{Binding ThemeText}"/>
                <TextBlock Text="Kural adÄ± ve hedef site" FontSize="11" Foreground="{Binding ThemeTextSecondary}"/>
              </StackPanel>
            </StackPanel>
            
            <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
              <TextBlock Grid.Column="0" Grid.Row="0" Text="Kural AdÄ±:" VerticalAlignment="Center" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <TextBox Grid.Column="1" Grid.Row="0" Text="{Binding Name}" Watermark="Ã–rn: Burs Bildirimleri" 
                       Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}" Padding="12,8"/>
              
              <TextBlock Grid.Column="0" Grid.Row="1" Text="Hedef Site:" VerticalAlignment="Center" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <ComboBox Grid.Column="1" Grid.Row="1" ItemsSource="{Binding SiteOptions}" 
                       SelectedIndex="{Binding SelectedSiteIndex}"
                       Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}"/>
              
              <StackPanel Grid.Column="1" Grid.Row="2" Orientation="Horizontal" Spacing="20">
                <CheckBox Content="âœ… Aktif" IsChecked="{Binding IsActive}" Foreground="{Binding ThemeText}"/>
                <CheckBox Content="ðŸ†• Sadece Yeni Ä°lanlar" IsChecked="{Binding OnlyNewListings}" Foreground="{Binding ThemeText}"/>
              </StackPanel>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Filter Criteria -->
        <Border Background="{Binding ThemeCardBg}" CornerRadius="12" Padding="20">
          <StackPanel Spacing="16">
            <StackPanel Orientation="Horizontal" Spacing="10">
              <Border Background="#10B98120" CornerRadius="8" Width="36" Height="36">
                <TextBlock Text="ðŸ”" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
              </Border>
              <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Filtre Kriterleri" FontSize="15" FontWeight="Bold" Foreground="{Binding ThemeText}"/>
                <TextBlock Text="Ä°lanlarÄ± filtrelemek iÃ§in kriterler" FontSize="11" Foreground="{Binding ThemeTextSecondary}"/>
              </StackPanel>
            </StackPanel>
            
            <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
              <TextBlock Grid.Column="0" Grid.Row="0" Text="Anahtar Kelimeler:" VerticalAlignment="Top" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <StackPanel Grid.Column="1" Grid.Row="0" Spacing="4">
                <TextBox Text="{Binding Keywords}" 
                         Watermark="burs, scholarship, staj (virgÃ¼lle ayÄ±rÄ±n)" 
                         AcceptsReturn="True" TextWrapping="Wrap" Height="70"
                         Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}" Padding="12,8"/>
                <TextBlock Text="ðŸ’¡ Birden fazla kelime virgÃ¼lle ayÄ±rÄ±n. Ä°lan baÅŸlÄ±ÄŸÄ± veya ÅŸirket adÄ±nda aranÄ±r." 
                           FontSize="10" Foreground="{Binding ThemeTextSecondary}"/>
              </StackPanel>
              
              <TextBlock Grid.Column="0" Grid.Row="1" Text="Åžehir:" VerticalAlignment="Center" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <TextBox Grid.Column="1" Grid.Row="1" Text="{Binding City}" Watermark="Ä°stanbul, Ankara, Remote" 
                       Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}" Padding="12,8"/>
              
              <TextBlock Grid.Column="0" Grid.Row="2" Text="Min Fiyat:" VerticalAlignment="Center" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <NumericUpDown Grid.Column="1" Grid.Row="2" Value="{Binding MinPrice}" Minimum="0" Maximum="1000000" 
                             FormatString="N0" Increment="1000" 
                             Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}"/>
              
              <TextBlock Grid.Column="0" Grid.Row="3" Text="Max Fiyat:" VerticalAlignment="Center" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <NumericUpDown Grid.Column="1" Grid.Row="3" Value="{Binding MaxPrice}" Minimum="0" Maximum="1000000" 
                             FormatString="N0" Increment="1000"
                             Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}"/>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Notification Settings -->
        <Border Background="{Binding ThemeCardBg}" CornerRadius="12" Padding="20">
          <StackPanel Spacing="16">
            <StackPanel Orientation="Horizontal" Spacing="10">
              <Border Background="#F59E0B20" CornerRadius="8" Width="36" Height="36">
                <TextBlock Text="ðŸ“§" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
              </Border>
              <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Bildirim AyarlarÄ±" FontSize="15" FontWeight="Bold" Foreground="{Binding ThemeText}"/>
                <TextBlock Text="Email adresleri ve zamanlama" FontSize="11" Foreground="{Binding ThemeTextSecondary}"/>
              </StackPanel>
            </StackPanel>
            
            <Grid ColumnDefinitions="120,*" RowDefinitions="Auto" RowSpacing="12">
              <TextBlock Grid.Column="0" Text="Email Adresleri:" VerticalAlignment="Top" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
              <StackPanel Grid.Column="1" Spacing="4">
                <TextBox Text="{Binding EmailsToNotify}" 
                         Watermark="email1@example.com, email2@example.com" 
                         AcceptsReturn="True" TextWrapping="Wrap" Height="70"
                         Background="{Binding ThemeInputBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}" Padding="12,8"/>
                <TextBlock Text="ðŸ’¡ Birden fazla email virgÃ¼lle ayÄ±rarak yazabilirsiniz." 
                           FontSize="10" Foreground="{Binding ThemeTextSecondary}"/>
              </StackPanel>
            </Grid>
                       
            <!-- Mail ZamanlamasÄ± -->
            <Border Background="{Binding ThemeInputBg}" CornerRadius="8" Padding="16" BorderBrush="{Binding ThemeBorder}" BorderThickness="1">
              <StackPanel Spacing="12">
                <CheckBox Content="ðŸ“… ZamanlanmÄ±ÅŸ Email GÃ¶nderimi Aktif" IsChecked="{Binding EnableScheduledEmail}" 
                          Foreground="{Binding ThemeText}" FontSize="13"/>
                
                <Grid ColumnDefinitions="120,*" IsVisible="{Binding EnableScheduledEmail}">
                  <TextBlock Grid.Column="0" Text="GÃ¶nderim AralÄ±ÄŸÄ±:" VerticalAlignment="Center" Foreground="{Binding ThemeTextSecondary}" FontSize="13"/>
                  <ComboBox Grid.Column="1" SelectedIndex="{Binding EmailIntervalHoursIndex}"
                            Background="{Binding ThemeCardBg}" Foreground="{Binding ThemeText}" BorderBrush="{Binding ThemeBorder}">
                    <ComboBoxItem Content="â±ï¸ 1 Saat"/>
                    <ComboBoxItem Content="â±ï¸ 6 Saat"/>
                    <ComboBoxItem Content="â±ï¸ 12 Saat"/>
                    <ComboBoxItem Content="â±ï¸ 24 Saat"/>
                  </ComboBox>
                </Grid>
                
                <TextBlock Text="â„¹ï¸ ZamanlanmÄ±ÅŸ emailler yeni ilanlarÄ± toplu olarak gÃ¶nderir." 
                           FontSize="10" Foreground="{Binding ThemeTextSecondary}"
                           IsVisible="{Binding EnableScheduledEmail}"/>
              </StackPanel>
            </Border>
          </StackPanel>
        </Border>

        <!-- Test Results -->
        <Border Background="#10B98120" CornerRadius="12" Padding="20" BorderBrush="#10B981" BorderThickness="1"
                IsVisible="{Binding TestResultMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
          <StackPanel Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="10">
              <TextBlock Text="ðŸ§ª" FontSize="16"/>
              <TextBlock Text="Test Sonucu" FontSize="14" FontWeight="Bold" Foreground="#10B981"/>
              <Border Background="#10B981" CornerRadius="10" Padding="8,2">
                <TextBlock Text="{Binding MatchedListingsCount, StringFormat='{}{0} eÅŸleÅŸme'}" FontSize="11" Foreground="White"/>
              </Border>
            </StackPanel>
            <TextBlock Text="{Binding TestResultMessage}" FontSize="12" Foreground="{Binding ThemeText}" TextWrapping="Wrap"/>
          </StackPanel>
        </Border>

      </StackPanel>
    </ScrollViewer>

    <!-- Message -->
    <Border Grid.Row="2" Background="#10B98120" Padding="16" Margin="24,0,24,12" CornerRadius="8"
            IsVisible="{Binding Message, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
      <TextBlock Text="{Binding Message}" Foreground="#10B981" TextWrapping="Wrap" FontSize="13"/>
    </Border>

    <!-- Buttons -->
    <Border Grid.Row="3" Background="{Binding ThemeCardBg}" Padding="24,16">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <Button Grid.Column="0" Content="ðŸ§ª KuralÄ± Test Et" Command="{Binding TestRuleCommand}"
                Background="#F59E0B" Foreground="White" Padding="20,10" FontWeight="600"/>
        
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
          <Button Content="Ä°ptal" Command="{Binding CancelCommand}"
                  Background="#64748B" Foreground="White" Padding="20,10"/>
          <Button Content="ðŸ’¾ Kaydet" Command="{Binding SaveCommand}"
                  Background="#10B981" Foreground="White" Padding="20,10" FontWeight="600"/>
        </StackPanel>
      </Grid>
    </Border>

  </Grid>

</Window>
